// broken because of compilation bug in Verilator

decl A: ubit<32>[8][8][8];
decl C4: ubit<32>[8][8];
decl sum: ubit<32>[8];

for (let r: ubit<4> = 0..8) {
  for (let q: ubit<4> = 0..8) {

    for (let p: ubit<4> = 0..8) {
      sum[p] := (0 as ubit<32>);
      ---
      for (let s: ubit<4> = 0..8) {
        let v: ubit<32> = A[r][q][s] * C4[s][p];
      } combine {
        sum[p] += v;
      }
    }
    ---
    for (let p: ubit<4> = 0..8) {
      A[r][q][p] := sum[p];
    }
  }
}
